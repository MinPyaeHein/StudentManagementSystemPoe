CREATE TABLE IF NOT EXISTS public.teachers
(
    id integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    email character varying(255) COLLATE pg_catalog."default" NOT NULL,
    address character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT teachers_pkey PRIMARY KEY (id)
,
    CONSTRAINT teachers_email_key UNIQUE (email)

)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.teachers
    OWNER to postgres;

CREATE TABLE IF NOT EXISTS public.students
(
    id integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    email character varying(255) COLLATE pg_catalog."default" NOT NULL,
    address character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT students_pkey PRIMARY KEY (id)
,
    CONSTRAINT students_email_key UNIQUE (email)

)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.students
    OWNER to postgres;

   //add ph column to students table
   ALTER TABLE public.students
   ADD COLUMN phone character varying(15) COLLATE pg_catalog."default";

   //add ph column to teachers table
   ALTER TABLE public.teachers
   ADD COLUMN phone character varying(15) COLLATE pg_catalog."default";

CREATE TABLE faculties (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    website_link VARCHAR(255),
    phone VARCHAR(20)
);

INSERT INTO faculties (name, email, website_link, phone) VALUES
('Dr. Alice Johnson', 'alice.johnson@example.com', 'https://aliceuniversity.edu', '123-456-7890'),
('Prof. Bob Smith', 'bob.smith@example.com', 'https://bobfaculty.edu', '234-567-8901'),
('Dr. Charlie Brown', 'charlie.brown@example.com', 'https://charlieacademy.edu', '345-678-9012'),
('Prof. David White', 'david.white@example.com', 'https://daviduniversity.edu', '456-789-0123'),
('Dr. Emma Green', 'emma.green@example.com', 'https://emmagreenedu.edu', '567-890-1234'),
('Prof. Frank Black', 'frank.black@example.com', 'https://frankfaculty.edu', '678-901-2345'),
('Dr. Grace Adams', 'grace.adams@example.com', 'https://graceacademy.edu', '789-012-3456'),
('Prof. Henry Ford', 'henry.ford@example.com', 'https://henryfaculty.edu', '890-123-4567'),
('Dr. Ivy Lee', 'ivy.lee@example.com', 'https://ivyuniversity.edu', '901-234-5678'),
('Prof. Jack King', 'jack.king@example.com', 'https://jackfaculty.edu', '012-345-6789');

ALTER TABLE public.students
ADD COLUMN faculty_id INTEGER NOT NULL DEFAULT 1,
ADD CONSTRAINT students_faculty_fk FOREIGN KEY (faculty_id)
REFERENCES public.faculties (id) ON DELETE SET DEFAULT;


<-allow faculty id to null ->
ALTER TABLE public.students
DROP CONSTRAINT students_faculty_fk;

ALTER TABLE public.students
ADD CONSTRAINT students_faculty_fk FOREIGN KEY (faculty_id)
    REFERENCES public.faculties (id)
    ON UPDATE NO ACTION
    ON DELETE SET NULL;

<-Create departments table->
CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    department VARCHAR(255) NOT NULL
);

INSERT INTO departments (department) VALUES
('Humanities and Social Sciences'),
('Natural Sciences'),
('Engineering and Technology'),
('Business and Management'),
('Health Sciences'),
('Arts and Design'),
('Law');

<-add degree and department to teachers ->
ALTER TABLE public.teachers
ADD COLUMN degree VARCHAR(255),
ADD COLUMN department_id integer NOT NULL DEFAULT 1,
ADD CONSTRAINT teachers_department_fk FOREIGN KEY (department_id)
    REFERENCES public.departments (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET DEFAULT;

select*from teachers



CREATE TYPE gender_enum AS ENUM ('male', 'female');
ALTER TABLE public.students ADD COLUMN gender gender_enum NOT NULL DEFAULT 'male';

//Create Table Degree

	CREATE TABLE degree (
    id SERIAL PRIMARY KEY,
    degree VARCHAR(255) NOT NULL
);

INSERT INTO degree (degree) VALUES
('Bachelor of Arts (B.A.)'),
('Bachelor of Science (B.S.)'),
('Bachelor of Engineering (B.Eng)'),
('Bachelor of Commerce (B.Com)'),
('Bachelor of Education (B.Ed)'),
('Bachelor of Fine Arts (B.F.A)');

//Update Teacher table and colum

ALTER TABLE public.teachers
DROP COLUMN degree,
ADD COLUMN degree_id INTEGER NOT NULL DEFAULT 1,
ADD CONSTRAINT teachers_degree_fk FOREIGN KEY (degree_id)
    REFERENCES public.degree (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
//Add teacher gender
ALTER TABLE public.teachers ADD COLUMN gender gender_enum NOT NULL DEFAULT 'male';


//Add Course Table
CREATE TABLE courses (
    id SERIAL PRIMARY KEY, -- Unique identifier for the course
    course_name VARCHAR(255) NOT NULL, -- The name of the course
    course_code VARCHAR(50) NOT NULL UNIQUE, -- A unique code for the course (e.g., "CS101")
    description TEXT, -- A brief description of the course
    credits INT NOT NULL CHECK (credits > 0), -- Number of credits the course offers (must be positive)
    department_id INT NOT NULL, -- Foreign key referencing the department
    teacher_id INT NOT NULL, -- Foreign key referencing the instructor/teacher
    schedule VARCHAR(255), -- Information on when the course will be held (days/times)
    capacity INT NOT NULL CHECK (capacity > 0), -- Maximum number of students allowed in the course
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Optional: For record creation timestamp
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- Optional: For record updates
);

-- Adding foreign key constraints
ALTER TABLE courses
ADD CONSTRAINT fk_department FOREIGN KEY (department_id) REFERENCES departments(id) ON DELETE CASCADE;

ALTER TABLE courses
ADD CONSTRAINT fk_teacher FOREIGN KEY (teacher_id) REFERENCES teachers(id) ON DELETE SET NULL;

//Add enrollments
CREATE TABLE enrollments (
    id SERIAL PRIMARY KEY, -- Unique identifier for the enrollment
    student_id INT NOT NULL, -- Foreign key referencing the Student model
    course_id INT NOT NULL, -- Foreign key referencing the Course model
    enrollment_date DATE DEFAULT CURRENT_DATE, -- The date the student enrolled in the course
    grade VARCHAR(5), -- Optionally, the studentâ€™s grade in the course (e.g., A, B, C, etc.)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Record creation timestamp
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- Record update timestamp
);

-- Adding foreign key constraints
ALTER TABLE enrollments
ADD CONSTRAINT fk_student FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE;

ALTER TABLE enrollments
ADD CONSTRAINT fk_course FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE CASCADE;